# SQL
[На головну](/README.md)


## Типи операцій
* **DML** (Data Manipulation Language) - Команди для роботи з даними
  * SELECT
  * INSERT
  * UPDATE
  * DELETE
  * MERGE
* **DDL** (Data Definition Language) - Команди для роботи з структурою
  * CREATE
  * ALTER
  * DROP
  * RENAME
  * TRUNCATE
* **TCL** (Transaction Control language) - Команди для транзакцій
  * COMMIT
  * ROLLBACK
  * SAVEPOINT
* **DCL** (Data Control Language) - Давать і забирать права у юзерів
  * GRANT
  * REVOKE


## SELECT statement
* 3 фундаментальні концепції
  * Projection - вибір стовпчиків з таблиці
  * Selection - вибір рядків з таблиці
  * Joining - об'єднування таблиць
* Select - тільки витягує дані і ні в якому разі не змінює
* **Projection**
  * `SELECT * FROM table;`
    * `*` - вибрати усі колонки
    * `FROM` - звідки брати, вказується таблиця
    * `;` - кінець команди, розділення між кількома командами, хоча одну команду можна писать в кілька рядків
  * `SELECT column(s) FROM table;`
    * `column(s)` - вказуємо 1 або кілька колонок таблиці, називається **select list**
    * `first_name, last_name` - через кому перераховуються назви колонок
  * `SELECT DISTINCT column(s) FROM table;`
    * `DISTINCT` - запезпечує унікальність значень по колонці або кількох
    * Має стояти перед перерахуванням колонок
    * Якщо колонок вказано кілька - то унікальність буде вираховуватися по всім колонкам
    * Неможливо вказуючи `DISTINCT` вимкнути його вплив на котрусь з вказаних колонок
    * `DISTINCT` склеює усі `null` в одне, це буде одне з унікальних значень
  * `SELECT column(s), expression(s) FROM table;`
    * `expression(s)` - вказуємо 1 або кілька виразів
    * `SELECT salary*2+employee_id FROM table;` - ось такий вираз з використанням колонок
    * `SELECT first_name, salary*2, salary FROM table;`
    * Операції для виразів для різних типів даних:
      * Числа
        * звичайні арифметичні: `+ - \ * ()`
        * якщо є хоч один `null` - результатом обчислення буде `null`
      * Дати
        * `date_end-date_start` - поверне кількість днів
        * `DATE_ADD(start_date, INTERVAL 10 DAY)` - додати кількість днів до поточної дати
          * `ADDDATE(start_date, 10)` - робить те саме
          * для Oracle SQL `date_start+7`
      * Тексти
        * `CONCAT(col1, col2)` - конкатенація - об'єднує колонки, якщо колонка не текстова, то значення перетворюється в текстове
        * `null` - робить так, що весь вираз буде `null`
          * для Oracle SQL - `col1||col2`, а також `null` - рахує як пустоту, загальний результат буде не `null`
  * `SELECT column(s) alias, expression(s) alias FROM table;`
    * `alias` - псевдонім на колонку або вираз
    * Синтаксис:
      * `column1 col1` - просто чере пробіл
      * `column1 as col1` - додаємо `as` - для читабельності
      * `column1 "col 1"` - якщо хочу використовувати пробіл - подвійні лапки треба
  * `SELECT 30*90;`
    * Просто обчислення якихось речей
      * для Oracle SQL - має обов'язково бути `FROM table`, тому там є спеціальна таблиця `dual` (вона 1х1)
  * `SELECT 'it''s my life'`
    * Для застосування одинарних лапок в текстовому значенні - треба їх подвоювати
* **Selection**
  * `SELECT ... FROM table WHERE condition(s)`
    * `condition(s)` - 1 або кілька умов
    * Числа - пишуться без лапок, а текстові значення в одинарних лапках
    * **implicit type conversion** - неявне перетворення типу
      * `...WHERE col1 = '1000'` якщо число в лапках написати - то з текста зробиться число
      * `...WHERE col1 = '2022.07.02'` якщо дату в лапках написати - то з тексту зробиться дата
  * Оператори порівняння:
    * `= < > <= >= <> !=`
    * `col1 BETWEEN 'val 1' AND 'val 2'` - перевіряє належність до інтервалу
    * `col1 IN(val1, val2)` - перевіряє чи є значення в масиві значень
    * `IS NULL` - перевіряє чи значення колонки `null`, а так - не правильно: `col1 = NULL`
    * `col1 LIKE 'a%b_c'` - пошук по патерну
      * `%` - 0, 1 або кілька символів
      * `_` - 1 символ
      * `col1 LIKE '5\%` - таким чином екрануються спецсимволи `%` та `_` - після слешу наступний 1 символ екранується
        * `col1 LIKE '5^% ESCAPE '^'` - таким чином для екранування можна використати свій символ
  * Логічні оператори або булеві оператори (повертають `true` чи `false`):
    * `col1 AND col2` - повертає `true`, якщо всі частини `true`, якщо перше не `true` - тоді далі не йде
    * `col1 OR col2` - повертає `true`, якщо хоч одна частина `true`, після першого `true` далі не йде
    * `col1 NOT expression` - змінює значення умови на протилежне
      * `WHERE NOT (col1 = 'val1')`
      * `WHERE col1 NOT LIKE 'val1`
      * `WHERE col1 NOT IN (val1, val2)`
      * `WHERE col1 NOT BETWEEN 'val1' AND 'val2`
      * `WHERE col1 IS NOT NULL`
  * Пріоритетність в порядку спадання:
    * `()`
    * `/`, `*`
    * `+`, `-`
    * `=`, `<`, `>`, `>=`, `<=`, `<>`, `!=`
    * `IS`, `LIKE`, `IN`
    * `BETWEEN`
    * `NOT`
    * `AND`
    * `OR`
  * Сортування
    * `...ORDER BY {column(s)|expression(s)|position} {ASC|DESC}`
      * Сортування працює в самому кінці, після обчислень і фільтрації
      * `column(s)` - 1 або кілька колонок, за якими сортувати
      * `expression(s)` - 1 або кілька виразів, за якими сортувати - вказувати або аліас або як вказано в **select list**
      * `position` - число, що вказує на номер колонки, по якій сортувати
      * `ASC|DESC` - порядок сортування по зростанню і спаданню відповідно
      * `-` - перед назвою колонки дає змогу впливати на сортування `null`
        * `ORDER BY -col1 ASC` - відсортує як `DESC`, але `null` буде на початку
        * `ORDER BY -col1 DESC` - відсортує як `ASC`, але `null` буде вкінці
          * для Orace SQL - використовується додаткова конструкція `NULLS FIRST` або `NULLS LAST`
      * `ORDER BY 2 DESC`
        * `SELECT * FROM` - буде обиратися колонка 2 в таблиці
        * `SELECT col1, col2 FROM` - буде обиратися колонка 2 в **select list**
      * `ORDER BY col1 DESC, col5, 2 DESC` - можна комбінувати як завгодно
  * Групування
    * `...GROUP BY`
      * Групування працює в зв'язку з функціями агрегації


## Функції
* Single-row функція - приймає скільки-то рядків і віддає стільки ж рядків
  * Дуже багато всяких функцій є
* Multiple-row функція - приймає рядки, а віддає 1 рядок (функції агрегації)
  * Функції агрегації не можна використовувати з single-row функціями
  * `COUNT({DISTINCT}col1|*)` - кількість рядків, якщо вказана колонка, а не `*`, то не буде рахувати рядки з `null`
  * `SUM({DISTINCT}col1)` - сумує значення всі, `null` ігнорує - працює тільки з числами
  * `AVG(col1)` - середнє арифметичне - працює тільки з числами
  * `MIN` і `MAX` - мінімальне і максимальне значення відповідно, працює не тільки з числами
* Nested функція - вкладена функція, яка слугує параметром для іншої
