# Testing
[На головну](../README.md)


## Типи тестів
* **Unit tests**
  * тестування якогось, як правило не великого, шматка коду в ізоляції від інших шматків коду
* **Integration tests**
  * тестування якогось шматка коду у взаємодії з іншими шматками коду
  * тут вже може бути [TDD](#tdd)
    * суть в тому, що ми спочатку визначаємо тести, котрі має проходити система, а потім вже пишемо систему і дивимося, щоб тести були зелені
  * тут також може бути [BDD](#bdd)
    * ще більше абстрагуємося від коду
    * пишемо сценарії у вигляді текстових файлів
      * сценарій: що маємо на вході, що робимо, що повертаємо
      * реалізація - cucumber
* **System tests**
  * зустрічається рідше, якщо є, то це показник крутості проєкту
  * більш високий рівень тестування
  * тестування в бойовому режимі, на якомусь тест-кластері
  * швидше за все - це робить QA відділ


## Solitary vs sociable tests
  * Різниця в тому, що Solitary - це ізольований стиль, а Sociable - це общітєльний стиль
  * при Sociable використовуються реальні пов'язані об'єкти або сервіси
  * при Solitary - використовуються стаби, моки,... Завдяки цьому сам тест ізольовано від інших пов'язаних об'єктів


## Flaky tests
* нестабільні тести - то працюють, то не працюють
* завдають великої шкоди процесам розробки
* як варіант - робиться карантин і на одних гілках ранають всі, на інших тільки стабільні
* в [RSpec](/docs/ruby/rspec.md) можливі 3 джерела таких тестів:
  * тести, пов'язані з часом - наприклад не враховується, що 1 година назад - це вже вчора, або часові пояси не враховуються
  * тести, пов'язані з Faker рандомом
  * тести, пов'язані з сторонніми API


## Contract tests
* В модульних тестах часто використовуються моки та стаби, це допомагає та прискорює
* Але є питання - чи не втрачаємо ми актуальність наших моків і стабів, якщо апіколи до реального апі не робляться ніколи
* Контрактні тести - це така пачка тестів, яка тестує контракти - чи не змінилося щось в інтерфейсах реальних сервісів
* Якщо змінилося - нам треба про це знати і нам треба апнути наші моки і стаби


## Тестова піраміда
* **unit** тести
* **integration** тести
* **end to end** тести
* від перших до останніх - до вершини піраміди такі штуки:
  * швидкість падає
  * кількість зменшується
  * важче писати
  * дорожче підтримувати


## Стратегія - як розуміти що тестувати
* **Ризик** – це ймовірність настання невизначеної події.
* По **рейтингу ризику** ми вирішуємо, скільки модульних тестів напишемо, і чим вище пріоритет, тим вище охоплення тестом.
* Матриця оцінки ризику – це матриця впливу ймовірності. Це надає команді уявлення про ризики та пріоритетність.
  * **Рейтинг ризику = ймовірність * серйозність**
  * **Ймовірність** — це міра ймовірності настання невизначеної події — експозиція щодо часу, близькості та повторення.
  * **Серйозність** – це ступінь впливу пошкодження або збитків, спричинених невизначеною подією.


## TDD
* Test Driven Development - розробка на основі тестів
* Добре підходить для юніт-тестування
* Тести зразу реалізуються в коді
* Пишуться девами
* Перевіряє роботу функцій
* План:
  * Пишемо тест
  * Перевіряємо, що тест лежить (ще немає коду)
  * Пишемо код
  * Перевіряємо, що тест пройшов
  * Тепер можна щось порефакторити
  * Повторюємо кроки


## BDD
* Behavior Driven Development - розробка на основі поведінки
* Добре підходить для інтеграційного тестування
* Часто описуються кроки на мові, зрозумілій усім, не тільки девам
* Пишуться кількома членами команди
* Перевіряє роботу сценаріїв
* План:
  * Описуємо процес, кроки:
    * юзер відкриває форму
    * треба перевірити числа, що видає форма
    * перевірка натискання сабміта
    * перевірка введених даних
    * ...
  * Описуємо кроки процесу за допомогою спеціального синтаксису
  * Реалізуємо ці кроки в коді
